# Relational Databases
## PostgreSQL
Relational database management systems are a key component of many websites and applications, they give us structure to manage our database. PostreSQL is a relational database management system that uses the SQL querying language.

### How To Install PostgreSQL Linux
1. In the terminal type `sudo apt-get update` to update your repositories locally.
2. Type `sudo apt-get install postgresql postgresql-contrib` to install PostgreSQL and additional tools and functionalities via `postgresql-contrib`
3. After the package is downloaded, to use the postgre prompt type `sudo -u postgress psql`
4. To exit the promt you can type type `\q`
5. Create a new user by typing `sudo -u postgress createuser --interactive` add the name of the name of the user and say yes for superuser.

### How To Build A RESTful
#### CRUD Operation
![HTTP CRUD Diagram](./httpCRUD)

#### Build express server & database/table
1. Use `npm init` to keep track of all your packages.
2. Create index.js in the folder.
3. Install express and pg library (way to interact with database) using `npm install express pg`
4. In the index.js file write the follwoing code to setup the node server and express app:
```
const express = require('express');
const app = express();

app.listen(process.port.env || 5000, () => {
    console.log("server is running on port 5000");
});
```
5. To use PostgresSQL we have have to the following commands in the diagram to interact with our database.
![Database Diagram And Commands](./)

6. Create a file called `database.sql`, this will make it easier for us to work with the database. Use the following commands to create a database and a table and also define the database table's shema.

```
CREATE DATABASE database_name;

--\c into database_name

CREATE TABLE tableName(
    unique_id SPECIAL PRIMARY KEY,
    description VARCHAR(255)
);
```

7. After saving the code above, paste it into the terminal to create your database.

#### Connect Server with Database
1. Create the file `db.js` to configure the pg library to connect to PostgresSQL.
```
const Pool = require("pg").Pool;

const pool = new Pool({
    user: "yourPostgresUserName",
    password: "yourPassword",
    database: "nameOfDatabaseToConnectTo",
    host: "localhost",
    port: 5432
});
```

2. Go to your `index.js` and require the `db.js`
```
const pool = require('./db');
```

#### Create Routes with db queries
- In the `index.js` write this code to use the middleware that allows you to get the `req.body`.
```
app.use(express.json())
```

- Then to add data we will use the the `post` method. We send a request to the server at the specific route and then async it so that we use`try` `catch` to wait before we execute ourcode. 

- Inside the `try` block we descrucutre the location of the row in the request body, then we await and then query the data into the SQL database. 

- The first parameter of `pool.query` is the query language used to add a value in the row. `INSERT INTO tableName {rowName} VALUES ($1) RETURNING` means that we are finding the location of the table and row then we insert a value inside that row that corresponds with `($1)` which is the second parameter `[rowName]` the row's name in the table.
```
//POST REQUEST
app.post("/routeName", async (req, res) => {
    try 
    {
        const { description } = req.body;
        const newValue = await pool.query(
            "INSERT INTO tableName {rowName} VALUES ($1) RETURNING",
            [rowName]
        );
    }

    res.json(newValue.rows[indexHere])

    catch (err) 
    {
        console.err(err.message);
    }
})
```
- To get all the todos we will be using the `get` method accompanied by the `SELECT * FROM tableName` in our `try` block.

```
//GET REQUEST - All Items In The Row
app.get("/routeName", async (req, res) => {
    try 
    {
        const allItemsInRows = await pool.query("SELECT * FROM tableName");

        res.json(allItemsInRows.rows);
    }
    catch (err)
    {
        console.error(err.message);
    }
});
```
- To get a specific item from a row we use the same method above how ever to pinpoint our item in the database we will be using `WHERE unique_id = idValHere;` this allows us to identify a individual item independently.
```
//GET REQUEST - A Specific Item In A Row
app.get("/routeName/:id", async (req, res) => {
    const { id } = req.params;

    try
    {
        const todo = await pool.query("SELECT * FROM tableName WHERE unique_id = $1", [id]);
        
        res.json(tableName.rows[0]);
    }

    catch (err)
    {
        console.error(err.message);
    }
});
```
- To update data we will use the `put` method accompanied by the query `UPDATE tableName SET rowName = 'New Name' WHERE unique_id = $1, [id];`
```
//PUT - UPDATE A SINGLE ITEM
app.get("/todos/:id, async (req, res) => {
    try 
    {
        const { id } = req.params; //WHERE
        const { rowName } = req.body; //SET

        const updateItem = await pool.query(
            "UPDATE tableName SET rowName = $1 WHERE unique_id = $2",
            [rowName, id]
        );

        res.json("Item was updated");
    }
    
    catch (err)
    {
        console.error(err.message);
    }    
})
```
To delete is easy, just as easy as looking up a single item! We will use the `DELTE FROM tableName WHERE unique_id = $1` query.
```
app.delete("/routeName/:id", async (req, res) => {
    try 
    {
        const { id } = req.params;
        const deleteItem = await pool.query("DELTE FROM tableName WHERE unique_id = $1", [id]);
    }

    catch (err)
    {
        console.error(err.message);
    }
})
```
### Tips and lookouts.
The `*` allows us to import all the data in a table, you can specify which row by replacing the star with the row name incase there is important data in other place.